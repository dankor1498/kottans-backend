## Цикл подій JavaScript

### The JavaScript Event Loop

**Ціль:** Пояснити внутрішні деталі того, як JavaScript працює з одним потоком і як він обробляє асинхронні функції. Навчитися розблоковувати цикл виконання функцій.

**Вступ:** Код JavaScript виконується однопоточно. За один раз відбувається лише одна річ.

Потрібно звертати увагу на те, як ви пишете свій код, і уникати всього, що може блокувати потік, наприклад, синхронних Інтернет-запитів або нескінченних циклів.

В основному потрібно мати на увазі те, що наш код буде виконуватися в одному циклі подій, і писати код з урахуванням цього, щоб уникнути його блокування.

**Приклад 1:**

```js
function repeat(operation, num) {
  if (num <= 0) return;
  operation();
  repeat(operation, --num);
}

function operation() {
  for (var i = 0; i < 1000000; i++) {
    // деякі дії
  }
}

repeat(operation, 100);

console.log("test");
```

**Пояснення:** Будь-який код JavaScript, який займає надто багато часу, щоб повернути елемент керування в цикл обробки подій, блокує виконання будь-якого коду JavaScript на сторінці, навіть блокує потік призначеного для користувача інтерфейсу, і користувач не може взаємодіяти зі сторінкою.

В даному випадку функція **_repeat_** буде блокувати поток, адже він буде виконувати 100 раз функцію **_operation_** яка містить великий цикл.
Наступний код, а саме **_console.log("test")_** буде очікувати невизначений час, сторінка буде заблокована.

Переглянути приклад запуску цих функцій графічно можна за допомогою ресурса [loupe](http://latentflip.com/loupe/) який демонструє роботу Call Stack зсередени.

**Приклад 2:**

```js
function repeat(operation, num) {
  if (num <= 0) return;

  operation();

  if (num % 10 === 0) {
    setTimeout(function () {
      repeat(operation, --num);
    });
  } else {
    repeat(operation, --num);
  }
}

function operation() {
  for (var i = 0; i < 1000000; i++) {
    // деякі дії
  }
}

repeat(operation, 100);

console.log("test");
```

**Пояснення:** Виклик функції [**_setTimeout_** з нульовою затиримкою](https://learn.javascript.ru/settimeout-setinterval#settimeout-s-nulevoy-zaderzhkoy) дозволяє викликати метод якнайшвидше, але лише після очищення Call Stack від функцій що в ньому знаходяться.

Модифікований метод **_repeat_** дозволяє кожні 10 викликів(дане число не є строго визначеним) очищувати Call Stack, та продовжувати виконання іншого коду. При цьому всі 100 викликів **_operation_** будуть опрацьовані, проте не послідовно.
